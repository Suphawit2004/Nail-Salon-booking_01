"use client";import {useMemo,useState} from "react";import {useSearchParams,useRouter} from "next/navigation";import Image from "next/image";import {CalendarDays,Clock} from "lucide-react";import LayoutWrapper from "../components/LayoutWrapper";const OPEN=9;const CLOSE=20;const TZ_OFFSET="+07:00";function todayISO(){const n=new Date();const y=n.getFullYear();const m=String(n.getMonth()+1).padStart(2,"0");const d=String(n.getDate()).padStart(2,"0");return `${y}-${m}-${d}`;}function generateSlots(step=30){const a=[];for(let h=OPEN;h<CLOSE;h++){for(let m=0;m<60;m+=step){a.push(`${String(h).padStart(2,"0")}:${String(m).padStart(2,"0")}`)}}return a;}function toBkk(date,time){if(!date||!time)return null;return new Date(`${date}T${time}:00${TZ_OFFSET}`);}function isPast(date,time){const d=toBkk(date,time);if(!d)return true;return d.getTime()<Date.now();}export default function ReservePage(){const q=useSearchParams();const router=useRouter();const serviceId=q.get("serviceId")??"svc-01";const serviceTitle=serviceId==="svc-01"?"ถอดPVC และต่อเล็บ":serviceId==="svc-02"?"ถอดPVC ทาสีเจล":"ทาสีเจล";const [date,setDate]=useState(todayISO());const [time,setTime]=useState("");const slots=useMemo(()=>generateSlots(30),[]);const next=()=>{if(!date||!time)return alert("กรุณาเลือกวันและเวลา");if(isPast(date,time))return alert("ไม่สามารถจองย้อนหลังได้ กรุณาเลือกเวลาถัดไป");router.push(`/reserve/confirm?serviceId=${serviceId}&date=${date}&time=${time}`);};return(<LayoutWrapper><h2 className="text-sm font-semibold text-pink-600 mb-3 mt-4">เลือกวัน เวลา</h2><div className="rounded-3xl border border-pink-100 shadow-[0_6px_14px_rgba(255,182,193,0.25)] bg-pink-50/60 p-4"><div className="flex gap-3"><div className="relative w-[88px] h-[88px] rounded-2xl bg-white ring-1 ring-pink-100 overflow-hidden"><Image src="/nail-blank.png" alt="thumb" fill className="object-cover"/></div><div className="flex-1"><div className="font-semibold text-gray-800">{serviceTitle}</div><div className="rounded-2xl bg-white border border-pink-100 p-3 mt-1 text-[13px] text-gray-600"><p>รายละเอียด: ละเอียด ประณีต สวยคม สีทา/ขัดเล็บ</p></div></div></div><div className="grid sm:grid-cols-2 gap-4 mt-4"><label className="flex flex-col"><span className="text-sm text-gray-600 flex items-center gap-2"><CalendarDays className="h-4 w-4 text-pink-500"/>วันที่</span><input type="date" className="border rounded-xl p-2 text-sm mt-1 focus:outline-pink-400" value={date} min={todayISO()} onChange={e=>{setDate(e.target.value);setTime("");}}/></label></div><div className="mt-4"><div className="text-sm text-gray-600 mb-2 flex items-center gap-2"><Clock className="h-4 w-4 text-pink-500"/> เวลา (ทุกๆ 30 นาที)</div><div className="grid grid-cols-4 sm:grid-cols-6 gap-2">{slots.map(t=>{const disabled=!date||isPast(date,t);const selected=time===t&&!disabled;return(<button key={t} type="button" onClick={()=>!disabled&&setTime(t)} disabled={disabled} className={["px-3 py-2 text-xs rounded-xl border transition",disabled?"opacity-40 cursor-not-allowed border-gray-200":selected?"bg-pink-400 text-white border-pink-400":"border-pink-200 hover:bg-pink-50"].join(" ")} title={disabled?"ไม่สามารถจองย้อนหลังได้":""}>{t}</button>);})}</div></div><div className="mt-4 flex justify-end gap-2"><button onClick={()=>history.back()} className="px-4 py-2 rounded-xl border border-pink-200 text-sm hover:bg-pink-50">ย้อนกลับ</button><button onClick={next} className="rounded-xl bg-pink-400 text-white px-6 py-2 text-sm font-semibold hover:bg-pink-500 shadow-sm">ถัดไป</button></div></div></LayoutWrapper>);}