import {promises as fs} from "fs";import path from "path";const DB_DIR=path.join(process.cwd(),".data");const DB_PATH=path.join(DB_DIR,"bookings.json");export type Booking={id:string;serviceId:string;serviceTitle:string;date:string;time:string;createdAt:string;status:"PENDING"|"CONFIRMED"|"CANCELLED";paymentMethod?:string;paymentRef?:string;paidAt?:string;};async function ensure(){await fs.mkdir(DB_DIR,{recursive:true}).catch(()=>{});try{await fs.access(DB_PATH);}catch{await fs.writeFile(DB_PATH,"[]","utf8");}}export async function readBookings():Promise<Booking[]>{await ensure();const txt=await fs.readFile(DB_PATH,"utf8").catch(()=>"[]");try{const data=JSON.parse(txt);return Array.isArray(data)?data as Booking[]:[]}catch{await fs.writeFile(DB_PATH,"[]","utf8");return[];}}export async function writeBookings(data:Booking[]){await ensure();await fs.writeFile(DB_PATH,JSON.stringify(data,null,2),"utf8");}